# Conquest DICOM docker image

This is a simple dockerized version of the Conquest DICOM server (see https://github.com/marcelvanherk/Conquest-DICOM-Server). 
This docker image contains just the basic `dgate` executable without the web interface.

Building the docker image is simple:

```
docker build -t rzinkstok/conquest .
```

The service can then be started using `docker-compose`:

```
cd compose
docker-compose up
```

## Mounted folders

- `compose/mount/data`: the folder containing DICOM files
- `compose/mount/logs`: the log files generated by the dgate application
- `compose/mount/config`: the configuration files used by dgate

## Configuration

Configuration of the server is specified in the `compose/mount/config/dicom.ini` file. This file is 
generated on the fly from the `compose/mount/config/dicom.ini.j2` template,
using some environment variables set in the `compose/.env` file. These are AETITLE and PORT: 
in changing these, you should update their value in the `.env` file and restart the whole stack.

### Import converters

Import converters can be added to the `compose/mount/config/converters.txt` file. Each line should contain a single
import converter definition. These will be added to the `dicom.ini` configuration file at runtime. 
For the syntax, see the Conquest manual 
(https://github.com/marcelvanherk/Conquest-DICOM-Server/blob/master/windowsmanual.pdf).
Note that the `ImportConverterX = ` part of the import converter definition is already added by the runtime 
script, so you only need to add the right hand side.

For example, to create a DICOM node that rejects MR data and prints a welcome message for CT data, add the
following to `compose/mount/config/converters.txt`:

```
ifequal "%m","MR"; destroy;
ifequal "%m","CT"; nop Welcome CT slice for patient %i!;
```

### Lua scripting

The import converters can be used to call a Lua script by setting the Lua script path as import converter.
A very basic example script is present in `compose/mount/scripts/printPatientInfo.lua`.

### ACRNEMA.map
 
For communication with other DICOM nodes, it is necessary to add them to the `compose/mount/config/acrnema.map`. 
Remember to use the hostname alias (`host.docker.internal`) for DICOM nodes running on the host machine. 


## To do
- Check and (if needed) fix connection to DICOM nodes on another host (docker networking might be an issue)
- Look into a simple way of starting multiple instances with different AETitles, ports, logging and databases

